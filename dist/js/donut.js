"use strict";var donutMargin={top:10,right:60,bottom:20,left:60},w=parseInt(d3.select("#donut-div").style("width"),10),w=w-donutMargin.left-donutMargin.right,h=parseInt(d3.select("#donut-div").style("height"),10),h=h-donutMargin.top-donutMargin.bottom,radius=Math.min(w,h)/2,labelRadius=w/2+8,tipDuration=200,donutDuration=600;d3.csv("/8step.io/production_data/ctc_data/divisions.csv",function(error,data){function arcTween(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return arcDef(a(t))}}error?console.log(error):console.log(data);var donutData=data,arcData=function(t){return+t.avg_revenue},svg=d3.select("#donut-div").append("svg").attr("width",w+donutMargin.left+donutMargin.right).attr("height",h+donutMargin.top+donutMargin.bottom).attr("id","canvas").append("g").attr("transform","translate("+(w/2+donutMargin.left)+","+(h/2+donutMargin.top)+")"),donutTip=d3.select("body").append("div").attr("class","tooltip donut-tip").style("opacity",0),color=d3.scaleOrdinal().range(["#FBAF43","#198F90","#9E004D","#F1594E","#9BD19D"]),arcDef=d3.arc().outerRadius(radius-10).innerRadius(radius-80),arcDefLabel=d3.arc().outerRadius(radius+40).innerRadius(radius),pie=d3.pie().sort(null).value(function(t){return arcData(t)}),arc=svg.selectAll(".arc").data(pie(donutData)).enter().append("g").attr("class","arc"),arcPath=arc.append("path").attr("d",arcDef).attr("class","arc-path").style("fill",function(t){return color(t.data.division_clean)}).each(function(t){this._current=t}),donutLabels=arc.append("text").attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("fill","white").attr("class","arc-label").attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean});arcPath.on("mouseover",function(t){donutTip.transition().duration(tipDuration).style("opacity",1),donutTip.html("<div class='title-display'>"+t.data.division_display+", FY17</div><br /><div class = data-display>Total Projects: "+t.data.projects+"<br />Total Revenue: $"+d3.format(",")(+t.data.revenue)+"</div>").style("left","18em").style("top","2em")}).on("mouseout",function(t){donutTip.transition().duration(tipDuration).style("opacity",0)}),d3.selectAll(".m-choice").on("click",function(){var arcValue=d3.select(this).attr("value"),arcData=function(d){return eval(arcValue)};pie.value(function(t){return arcData(t)}),arcPath.data(pie(donutData)),arcPath.transition().duration(donutDuration).attrTween("d",arcTween),d3.selectAll(".arc-label").data(pie(donutData)).transition().duration(donutDuration).attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean})})});