d3.csv("datadev/crime.csv",function(t,e){t?console.log(t):console.log(e);var a=e,n={top:40,right:40,bottom:60,left:60},r=740-n.left-n.right,i=740-n.left-n.right,l=30,o=-30,d=function(t){return t.key},c=d3.select("body").append("svg").attr({height:i+n.top+n.bottom,width:r+n.left+n.right}).append("g").attr({transform:"translate("+n.left+","+n.top+")"}),s=(c.append("clipPath").attr({id:"chart-area"}).append("rect").attr({x:1-l,y:1-o,width:r,height:i}),d3.scale.linear().domain([0,d3.max(a,function(t){return+t.rape100k})]).range([0,r])),u=d3.scale.linear().domain([0,d3.max(a,function(t){return+t.murder100k})]).range([i,0]),f=d3.scale.linear().domain([d3.min(a,function(t){return+t.Pop}),d3.max(a,function(t){return+t.Pop})]).range([5,50]),g=d3.svg.axis().scale(s).orient("bottom").ticks(5),p=d3.svg.axis().scale(u).orient("left").ticks(5);c.append("g").attr({id:"bubbles-group","clip-path":"url(#chart-area)"}).selectAll("circle").data(a,d).enter().append("circle").attr({cx:function(t){return s(+t.rape100k)},cy:function(t){return u(+t.murder100k)},r:function(t){return f(+t.Pop)},class:"bubbles",fill:"rgb(179,120,211)"});c.append("g").attr({class:"xaxis",transform:"translate(0,"+(i+l)+")"}).call(g),c.append("g").attr({class:"yaxis",transform:"translate("+o+",0)"}).call(p)});var margin={top:40,right:140,bottom:40,left:60},w=parseInt(d3.select("#scatter-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#scatter-div").style("height"),10),h=h-margin.top-margin.bottom,canvasPadding={top:10,right:10,bottom:10,left:60},textShift=0,dotsShift=0,xaxisShiftX=0,yaxisShiftX=0,xaxisShiftY=h,yaxisShiftY=0,infoTop=115,infoLeft=w+margin.left,infoWidth="12em",infoHeight="30em",titleText=d3.select("h2#chart-title").append("text.title-text").text("Political Stability (X) vs Control of Corruption(Y)");d3.csv("/8step.io/production_data/world_data/datadev/world.csv",function(t,e){t?console.log(t):console.log(e);var a=e,n=function(t,e){return t.country},r=function(t){return+t.polistab},i=function(t){return 100-+t.press},l=function(t){return+t.gdphead},o=d3.tip().attr({class:"d3-tip"}).style({top:infoTop,left:infoLeft,width:infoWidth,height:infoHeight}).direction("e").html(function(t){return"<p id='tiphead'>"+t.country+"</p><p id='tipbody'><p class='tip-subhead'>Income Group:</p> "+t.ig+"</p></p><p id='tipbody'><p class='tip-subhead'>Region:</p> "+t.region+"</p>"}),d=d3.select("#scatter-div").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}),c=d3.scale.linear().domain([d3.min(a,function(t){return r(t)}),d3.max(a,function(t){return r(t)})]).range([0,w]).nice(),s=d3.scale.linear().domain([d3.max(a,function(t){return i(t)}),d3.min(a,function(t){return i(t)})]).range([0,h]),u=d3.scale.linear().domain([0,d3.max(a,function(t){return l(t)})]).range([4,40]).nice(),f=d3.svg.axis().scale(c).orient("bottom"),g=d3.svg.axis().scale(s).orient("left"),p=function(t){d.append("g").classed("guide",!0).append("line").attr("y1",d3.select(".a-dot").attr("cy")).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",0).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill")),d.append("g").classed("guide",!0).append("line").attr("y1",h).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",d3.select(".a-dot").attr("cx")).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill"))},m=function(){var t=this;d3.select(t).attr("opacity",1).classed("a-dot",!0).classed("dots",!1),p(),d3.selectAll("circle.dots").attr("opacity",.15)},x=function(){var t=this;d3.select(t).classed("a-dot",!1).classed("dots",!0),d3.selectAll(".guide").remove(),d3.selectAll("circle.dots").attr("opacity",.85)};d.append("g").attr({id:"dots-group"}).selectAll("circle").data(a,n).enter().append("circle").filter(function(t){return r(t)}).filter(function(t){return i(t)}).filter(function(t){return l(t)}).attr({class:"dots",id:function(t){return t.country},cx:function(t){return c(r(t))},cy:function(t){return s(i(t))},r:function(t){return u(l(t))},"pointer-events":"all",fill:function(t){return"Europe & Central Asia"==t.region?"#CEE879":"Middle East & North Africa"==t.region?"#FFA700":"Sub-Saharan Africa"==t.region?"#54EBBA":"North America"==t.region?"#1DC28C":"South Asia"==t.region?"#FF93D2":"East Asia & Pacific"==t.region?"#8CD19D":"Latin America & Caribbean"==t.region?"#FF0D00":"black"},opacity:.85}).call(o).on("mouseenter",o.show).on("mouseover",m).on("mouseleave",o.hide).on("mouseout",x),d3.select("#dropdown-x li a").on("click",function(){b()});d.append("g").attr({class:"xaxis",transform:"translate("+xaxisShiftX+","+xaxisShiftY+")"}).call(f),d.append("g").attr({class:"yaxis",transform:"translate("+yaxisShiftX+","+yaxisShiftY+")"}).call(g);var b=function(){var t=function(t){return d3.select(this).attr("value")},e=function(e){return t},n=d3.scale.linear().domain([d3.min(a,function(t){return e(t)}),d3.max(a,function(t){return e(t)})]).range([0,w]).nice();d3.select("#dots-group").selectAll("circle").attr({cx:function(t){return n(e(t))}})}});var margin={top:40,right:10,bottom:40,left:10},w=parseInt(d3.select("#barsdiv").style("width"),10),w=w-margin.left-margin.right,h=8e3-margin.top-margin.bottom,canvasPadding={top:0,right:100,bottom:0,left:0},textShiftUp=-134,barShiftUp=-126,axisShiftUp=-18;barpadding=2,labelPaddingLeft=4,labelPaddingTop=barShiftUp+138;var maxDelay=1e4,barDuration=800,axisDuration=800,defaultFade=50,hoverDuration=200,titleText=d3.select("h2#title").append("text.title-text").text("Incidents of Murder, per 100k Individuals, 2013").attr({class:"title-text","font-size":"24px"});d3.csv("/8step.io/production_data/crime_data/datadev/crime.csv",function(t,e){t?console.log(t):console.log(e);var a=e,n=function(t,e){return e},r=function(t){return"M.D."==t.Loc.slice(-4)?t.Loc.substring(0,t.Loc.length-5):"M.S.A."==t.Loc.slice(-6)?t.Loc.substring(0,t.Loc.length-7):t.Loc.substring(0,t.Loc.length-7)},i=d3.tip().attr({class:"d3-tip"}).offset([0,0]).direction("n").html(function(t){return"<p id='tiphead'>"+r(t)+"</p><p id='tipbody'>Population: "+d3.format(",")(+t.Pop)+"</p>"}),l=d3.select("#barsdiv").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,viewBox:"0 0 380 8000",preserveAspectRatio:"xMinYMin meet",id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}).call(i),o=d3.scale.linear().domain([0,d3.max(a,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice(),d=function(t){return o(+t.murder100k)},c=function(t){return d(t)+labelPaddingLeft},s=d3.scale.ordinal().domain(d3.range(a.length)).rangeRoundBands([0,h],.05),u=d3.svg.axis().scale(o).orient("top").ticks(5);l.selectAll("rect").data(a,n).enter().append("rect").attr({y:function(t,e){return s(e)},x:function(t){return 0},width:d,height:function(t,e){return s.rangeBand()},transform:"translate(0,"+barShiftUp+")",class:"bars"}).on("mouseover",i.show).on("mouseout",i.hide),l.selectAll("text.loclabels").data(a,n).enter().append("text").text(r).attr({x:function(t){return labelPaddingLeft},y:function(t,e){return s(e)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"loclabels"}),l.selectAll("text.valuelabels").data(a,n).enter().append("text").text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:c,y:function(t,e){return s(e)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"valuelabels"});l.append("g").attr({class:"xaxis",transform:"translate(0,"+axisShiftUp+")"}).call(u),d3.select("button#violentcrime").on("click",function(){p()}),d3.select("button#rape").on("click",function(){g()}),d3.select("button#murder").on("click",function(){f()});var f=function(){a.sort(function(t,e){return d3.descending(+t.murder100k,+e.murder100k)});var t=d3.scale.linear().domain([0,d3.max(a,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice();d=function(e){return t(+e.murder100k)},d3.selectAll("rect.bars").data(a,n).transition().delay(function(t,e){return e/a.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,e){return s(e)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Murder, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(a,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,e){return s(e)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(a,n).transition().delay(function(t,e){return e/a.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:c,y:function(t,e){return s(e)+labelPaddingTop}});var e=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(e);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(a,n).attr("x",c),d3.select(".xaxis").call(e)};d3.select(window).on("resize",function(){i()})},g=function(){a.sort(function(t,e){return d3.descending(+t.rape100k,+e.rape100k)});var t=d3.scale.linear().domain([0,d3.max(a,function(t){return+t.rape100k})]).range([0,w-canvasPadding.right]).nice();d=function(e){return t(+e.rape100k)},d3.selectAll("rect.bars").data(a,n).transition().delay(function(t,e){return e/a.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,e){return s(e)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Rape, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(a,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,e){return s(e)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(a,n).transition().delay(function(t,e){return e/a.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.rape100k)}).attr({x:c,y:function(t,e){return s(e)+labelPaddingTop}});var e=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(e);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(a,n).attr("x",c),d3.select(".xaxis").call(e)};d3.select(window).on("resize",function(){i()})},p=function(){a.sort(function(t,e){return d3.descending(+t.violentcrime100k,+e.violentcrime100k)});var t=d3.scale.linear().domain([0,d3.max(a,function(t){return+t.violentcrime100k})]).range([0,w-canvasPadding.right]).nice();d=function(e){return t(+e.violentcrime100k)},d3.selectAll("rect.bars").data(a,n).transition().delay(function(t,e){return e/a.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,e){return s(e)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Violent Crime, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(a,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,e){return s(e)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(a,n).transition().delay(function(t,e){return e/a.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.violentcrime100k)}).attr({x:c,y:function(t,e){return s(e)+labelPaddingTop}});var e=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(e);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(a,n).attr("x",c),d3.select(".xaxis").call(e)};d3.select(window).on("resize",function(){i()})},m=function(){var t=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;o.range([0,t-canvasPadding.right]),d3.select("svg").attr("width",t),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(a,n).attr("x",c),d3.select(".xaxis").call(u)};d3.select(window).on("resize",function(){m()})});