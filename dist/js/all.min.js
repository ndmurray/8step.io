d3.csv("datadev/crime.csv",function(t,a){t?console.log(t):console.log(a);var e=a,n={top:40,right:40,bottom:60,left:60},r=740-n.left-n.right,i=740-n.left-n.right,l=30,o=-30,d=function(t){return t.key},s=d3.select("body").append("svg").attr({height:i+n.top+n.bottom,width:r+n.left+n.right}).append("g").attr({transform:"translate("+n.left+","+n.top+")"}),c=(s.append("clipPath").attr({id:"chart-area"}).append("rect").attr({x:1-l,y:1-o,width:r,height:i}),d3.scale.linear().domain([0,d3.max(e,function(t){return+t.rape100k})]).range([0,r])),u=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([i,0]),f=d3.scale.linear().domain([d3.min(e,function(t){return+t.Pop}),d3.max(e,function(t){return+t.Pop})]).range([5,50]),g=d3.svg.axis().scale(c).orient("bottom").ticks(5),p=d3.svg.axis().scale(u).orient("left").ticks(5);s.append("g").attr({id:"bubbles-group","clip-path":"url(#chart-area)"}).selectAll("circle").data(e,d).enter().append("circle").attr({cx:function(t){return c(+t.rape100k)},cy:function(t){return u(+t.murder100k)},r:function(t){return f(+t.Pop)},class:"bubbles",fill:"rgb(179,120,211)"});s.append("g").attr({class:"xaxis",transform:"translate(0,"+(i+l)+")"}).call(g),s.append("g").attr({class:"yaxis",transform:"translate("+o+",0)"}).call(p)});var margin={top:40,right:140,bottom:40,left:60},w=parseInt(d3.select("#scatter-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#scatter-div").style("height"),10),h=h-margin.top-margin.bottom,canvasPadding={top:10,right:10,bottom:10,left:60},textShift=0,dotsShift=0,xaxisShiftX=0,yaxisShiftX=0,xaxisShiftY=h,yaxisShiftY=0,infoTop=115,infoLeft=w+margin.left,infoWidth="12em",infoHeight="30em",titleText=d3.select("h2#chart-title").append("text.title-text").text("Political Stability (X) vs Control of Corruption(Y)");d3.csv("/8step.io/production_data/world_data/datadev/world.csv",function(error,data){error?console.log(error):console.log(data);var worldData=data,key=function(t,a){return t.country},dataX=function(t){return+t.polistab},dataY=function(t){return 100-+t.press},dataR=function(t){return+t.gdphead};console.log(dataX.toString());var dotTips=d3.tip().attr({class:"d3-tip"}).style({top:infoTop,left:infoLeft,width:infoWidth,height:infoHeight}).direction("e").html(function(t){return"<p id='tiphead'>"+t.country+"</p><p class='tip-subhead'>Income Group:</p><p class='tip-body'>"+t.ig+"</p><p class='tip-subhead'>Region:</p><p class='tip-body'>"+t.region+"</p>"}),svg=d3.select("#scatter-div").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}),xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([0,w]).nice(),yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h]).nice(),rScale=d3.scale.linear().domain([0,d3.max(worldData,function(t){return dataR(t)})]).range([4,40]).nice(),xAxis=d3.svg.axis().scale(xScale).orient("bottom"),yAxis=d3.svg.axis().scale(yScale).orient("left"),guideLines=function(t){svg.append("g").classed("guide",!0).append("line").attr("y1",d3.select(".a-dot").attr("cy")).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",0).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill")),svg.append("g").classed("guide",!0).append("line").attr("y1",h).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",d3.select(".a-dot").attr("cx")).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill"))},mouseOn=function(){d3.select(this).attr("opacity",1).classed("a-dot",!0).classed("dots",!1),guideLines(),d3.selectAll("circle.dots").attr("opacity",.15)},mouseOff=function(){d3.select(this).classed("a-dot",!1).classed("dots",!0),d3.selectAll(".guide").remove(),d3.selectAll("circle.dots").attr("opacity",.85)},dotsGroup=svg.append("g").attr({id:"dots-group"}),dotsFilter=dotsGroup.append("defs").append("filter").attr({id:"dots-filter",x:0,y:0,width:"200%",height:"200%"}),shadowOffset=dotsFilter.append("feOffset").attr({result:"offOut",in:"SourceGraphic",dx:20,dy:20}),shadowBlend=dotsFilter.append("feBlend").attr({in:"SourceGraphic",in2:"offOut",mode:"normal"}),dots=d3.select("#dots-group").selectAll("circle").data(worldData,key).enter().append("circle").filter(function(t){return dataX(t)}).filter(function(t){return dataY(t)}).filter(function(t){return dataR(t)}).attr({class:"dots",id:function(t){return t.country},cx:function(t){return xScale(dataX(t))},cy:function(t){return yScale(dataY(t))},r:function(t){return rScale(dataR(t))},"pointer-events":"all",fill:function(t){return"High income: nonOECD"==t.ig?"#CEE879":"Low income"==t.ig?"#FFA700":"Upper middle income"==t.ig?"#54EBBA":"Lower middle income"==t.ig?"#1DC28C":"High income: OECD"==t.ig?"#FF93D2":"black"},opacity:.85}).style({}).call(dotTips).on("mouseenter",dotTips.show).on("mouseover",mouseOn).on("mouseleave",dotTips.hide).on("mouseout",mouseOff);svg.append("g").attr({class:"xaxis",transform:"translate("+xaxisShiftX+","+xaxisShiftY+")"}).call(xAxis);var xLabel=svg.append("text").attr({"text-anchor":"middle",transform:function(t){return"translate("+w/2+","+(xaxisShiftY+(h-xaxisShiftY)/2)+")"}}).text("Value");svg.append("g").attr({class:"yaxis",transform:"translate("+yaxisShiftX+","+yaxisShiftY+")"}).call(yAxis),d3.selectAll(".x-choice").on("click",function(){var xValue=d3.select(this).attr("value");console.log(xValue);var dataX=function(d){return eval(xValue)},xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([0,w]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){return dataX(t)}).transition().duration(1e3).attr({cx:function(t){return xScale(dataX(t))}});var xAxis=d3.svg.axis().scale(xScale).orient("bottom");d3.select(".xaxis").transition().duration(1e3).call(xAxis)}),d3.selectAll(".y-choice").on("click",function(){var yValue=d3.select(this).attr("value");console.log(yValue);var dataY=function(d){return eval(yValue)},yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([h,0]);d3.select("#dots-group").selectAll("circle").filter(function(t){return dataY(t)}).transition().duration(1e3).attr({cy:function(t){return yScale(dataX(t))}});var yAxis=d3.svg.axis().scale(yScale).orient("left");d3.select(".yaxis").transition().duration(1e3).call(yAxis)})});var margin={top:40,right:10,bottom:40,left:10},w=parseInt(d3.select("#barsdiv").style("width"),10),w=w-margin.left-margin.right,h=8e3-margin.top-margin.bottom,canvasPadding={top:0,right:100,bottom:0,left:0},textShiftUp=-134,barShiftUp=-126,axisShiftUp=-18;barpadding=2,labelPaddingLeft=4,labelPaddingTop=barShiftUp+138;var maxDelay=1e4,barDuration=800,axisDuration=800,defaultFade=50,hoverDuration=200,titleText=d3.select("h2#title").append("text.title-text").text("Incidents of Murder, per 100k Individuals, 2013").attr({class:"title-text","font-size":"24px"});d3.csv("/8step.io/production_data/crime_data/datadev/crime.csv",function(t,a){t?console.log(t):console.log(a);var e=a,n=function(t,a){return a},r=function(t){return"M.D."==t.Loc.slice(-4)?t.Loc.substring(0,t.Loc.length-5):"M.S.A."==t.Loc.slice(-6)?t.Loc.substring(0,t.Loc.length-7):t.Loc.substring(0,t.Loc.length-7)},i=d3.tip().attr({class:"d3-tip"}).offset([0,0]).direction("n").html(function(t){return"<p id='tiphead'>"+r(t)+"</p><p id='tipbody'>Population: "+d3.format(",")(+t.Pop)+"</p>"}),l=d3.select("#barsdiv").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,viewBox:"0 0 380 8000",preserveAspectRatio:"xMinYMin meet",id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}).call(i),o=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice(),d=function(t){return o(+t.murder100k)},s=function(t){return d(t)+labelPaddingLeft},c=d3.scale.ordinal().domain(d3.range(e.length)).rangeRoundBands([0,h],.05),u=d3.svg.axis().scale(o).orient("top").ticks(5);l.selectAll("rect").data(e,n).enter().append("rect").attr({y:function(t,a){return c(a)},x:function(t){return 0},width:d,height:function(t,a){return c.rangeBand()},transform:"translate(0,"+barShiftUp+")",class:"bars"}).on("mouseover",i.show).on("mouseout",i.hide),l.selectAll("text.loclabels").data(e,n).enter().append("text").text(r).attr({x:function(t){return labelPaddingLeft},y:function(t,a){return c(a)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"loclabels"}),l.selectAll("text.valuelabels").data(e,n).enter().append("text").text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"valuelabels"});l.append("g").attr({class:"xaxis",transform:"translate(0,"+axisShiftUp+")"}).call(u),d3.select("button#violentcrime").on("click",function(){p()}),d3.select("button#rape").on("click",function(){g()}),d3.select("button#murder").on("click",function(){f()});var f=function(){e.sort(function(t,a){return d3.descending(+t.murder100k,+a.murder100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice();d=function(a){return t(+a.murder100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Murder, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},g=function(){e.sort(function(t,a){return d3.descending(+t.rape100k,+a.rape100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.rape100k})]).range([0,w-canvasPadding.right]).nice();d=function(a){return t(+a.rape100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Rape, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.rape100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},p=function(){e.sort(function(t,a){return d3.descending(+t.violentcrime100k,+a.violentcrime100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.violentcrime100k})]).range([0,w-canvasPadding.right]).nice();d=function(a){return t(+a.violentcrime100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Violent Crime, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.violentcrime100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},x=function(){var t=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;o.range([0,t-canvasPadding.right]),d3.select("svg").attr("width",t),l.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(u)};d3.select(window).on("resize",function(){x()})});