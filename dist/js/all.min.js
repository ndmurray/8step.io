function arcTween(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return arcDef(a(t))}}function ready(t,a,e){t?console.log(t):console.log(a);var n={};e.forEach(function(t){n[t.id]=+t.rate});var r=d3.scaleQuantile().domain(function(t){n.values()}).range(d3.schemeBlues[9]);svg.append("g").attr("class","counties").selectAll("path").data(topojson.feature(a,a.objects.counties).features).enter().append("path").attr("d",mapPath),d3.selectAll("path").attr("fill",function(t){return r(n[t.id])})}d3.csv("datadev/crime.csv",function(t,a){t?console.log(t):console.log(a);var e=a,n={top:40,right:40,bottom:60,left:60},r=740-n.left-n.right,i=740-n.left-n.right,o=30,l=-30,d=function(t){return t.key},s=d3.select("body").append("svg").attr({height:i+n.top+n.bottom,width:r+n.left+n.right}).append("g").attr({transform:"translate("+n.left+","+n.top+")"}),c=(s.append("clipPath").attr({id:"chart-area"}).append("rect").attr({x:1-o,y:1-l,width:r,height:i}),d3.scale.linear().domain([0,d3.max(e,function(t){return+t.rape100k})]).range([0,r])),u=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([i,0]),p=d3.scale.linear().domain([d3.min(e,function(t){return+t.Pop}),d3.max(e,function(t){return+t.Pop})]).range([5,50]),f=d3.svg.axis().scale(c).orient("bottom").ticks(5),g=d3.svg.axis().scale(u).orient("left").ticks(5);s.append("g").attr({id:"bubbles-group","clip-path":"url(#chart-area)"}).selectAll("circle").data(e,d).enter().append("circle").attr({cx:function(t){return c(+t.rape100k)},cy:function(t){return u(+t.murder100k)},r:function(t){return p(+t.Pop)},class:"bubbles",fill:"rgb(179,120,211)"});s.append("g").attr({class:"xaxis",transform:"translate(0,"+(i+o)+")"}).call(f),s.append("g").attr({class:"yaxis",transform:"translate("+l+",0)"}).call(g)});var lineMargin={top:60,right:40,bottom:70,left:80},lineW=parseInt(d3.select("#line-div").style("width"),10),lineW=lineW-lineMargin.left-lineMargin.right,lineH=parseInt(d3.select("#line-div").style("height"),10),lineH=lineH-lineMargin.top-lineMargin.bottom,lineDuration=600,tipDuration=200,parseDate=d3.timeParse("%d-%b-%y"),formatTimeWeek=d3.timeFormat("%d-%b-%y"),formatTimeMonth=d3.timeFormat("%b"),formatTimeYear=d3.timeFormat("%Y"),xScale=d3.scaleTime().range([0,lineW]),yScale=d3.scaleLinear().range([lineH,0]),dotRadius="0.25em",dataTitle="Total Revenue ($US)";d3.csv("/8step.io/production_data/ctc_data/ctc_lines.csv",function(t){return t.date=parseDate(t.date),t.division_clean=t.division_clean,t.avg_revenue=+t.avg_revenue,t.projects_share=+t.projects_share,t.projects_total=+t.projects_total,t.revenue_share=+t.revenue_share,t.revenue_total=+t.revenue_total,t},function(error,data){error?console.log(error):console.log(data);var timeData=data,ushData=data.filter(function(t){return"USH"==t.division_clean}),sepData=data.filter(function(t){return"SEP"==t.division_clean}),ihdData=data.filter(function(t){return"IHD"==t.division_clean}),iegData=data.filter(function(t){return"IEG"==t.division_clean}),enrData=data.filter(function(t){return"ENR"==t.division_clean}),lineData=function(t){return t.revenue_total};xScale.domain(d3.extent(timeData,function(t){return t.date})),yScale.domain(d3.extent(timeData,function(t){return lineData(t)})).nice();var xAxis=d3.axisBottom().scale(xScale).tickFormat(formatTimeMonth),yAxis=d3.axisLeft().scale(yScale),line=d3.line().curve(d3.curveLinear).x(function(t){return xScale(t.date)}).y(function(t){return yScale(lineData(t))}),titleText=d3.select("#chart-title").append("text").attr("class","title-text").text(dataTitle+" by Division, CTC, FY17"),svg=d3.select("#line-div").append("svg").attr("width",lineW+lineMargin.left+lineMargin.right).attr("height",lineH+lineMargin.top+lineMargin.bottom).attr("id","line-canvas").append("g").attr("transform","translate("+lineMargin.left+","+lineMargin.top+")"),pathUSH=svg.append("path").datum(ushData).attr("d",line).attr("class","path").attr("id","ush-path"),nodesUSH=svg.selectAll("circle.ush-nodes").data(ushData).enter().append("circle").attr("class","nodes ush-nodes").attr("r",dotRadius).attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(lineData(t))}),pathSEP=svg.append("path").datum(sepData).attr("d",line).attr("class","path").attr("id","sep-path"),nodesSEP=svg.selectAll("circle.sep-nodes").data(sepData).enter().append("circle").attr("class","nodes sep-nodes").attr("r",dotRadius).attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(lineData(t))}),pathIHD=svg.append("path").datum(ihdData).attr("d",line).attr("class","path").attr("id","ihd-path"),nodesIHD=svg.selectAll("circle.ihd-nodes").data(ihdData).enter().append("circle").attr("class","nodes ihd-nodes").attr("r",dotRadius).attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(lineData(t))}),pathIEG=svg.append("path").datum(iegData).attr("d",line).attr("class","path").attr("id","ieg-path"),nodesIEG=svg.selectAll("circle.ieg-nodes").data(iegData).enter().append("circle").attr("class","nodes ieg-nodes").attr("r",dotRadius).attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(lineData(t))}),pathENR=svg.append("path").datum(enrData).attr("d",line).attr("class","path").attr("id","enr-path"),nodesENR=svg.selectAll("circle.enr-nodes").data(enrData).enter().append("circle").attr("class","nodes enr-nodes").attr("r",dotRadius).attr("cx",function(t){return xScale(t.date)}).attr("cy",function(t){return yScale(lineData(t))}),lineTip=d3.select("#line-div").append("div").attr("id","line-tip").style("display","none");d3.selectAll(".nodes").on("mouseover",function(t){lineTip.transition().duration(tipDuration).style("display","inline-block"),lineTip.html("<p><span class='line-val-display'>"+d3.format(",.2f")(lineData(t))+"</span><br /><span class='time-display'>"+formatTimeMonth(t.date)+" "+formatTimeYear(t.date)+"</span></p>").style("left",d3.select(this).attr("cx")).style("top",d3.select(this).attr("cy"))}).on("mouseout",function(){lineTip.transition().duration(tipDuration).style("display","none")}),svg.append("g").attr("class","axis x-axis").attr("transform","translate(0,"+lineH+")").call(xAxis),d3.selectAll(".x-axis text").attr("transform","rotate(-45)").attr("text-anchor","end"),svg.append("g").attr("class","axis y-axis").call(yAxis);var yLabelBox=d3.select(".y-axis text").node().getBBox(),yLabelShift=yLabelBox.x-50,yLabel=svg.append("text").text(dataTitle).attr("fill","gray").attr("text-anchor","middle").attr("transform","translate("+yLabelShift+","+lineH/2+"), rotate(-90)"),donutMargin={top:0,right:30,bottom:0,left:30},w=parseInt(d3.select("#donut-div").style("width"),10),w=w-donutMargin.left-donutMargin.right,h=parseInt(d3.select("#donut-div").style("height"),10),h=h-donutMargin.top-donutMargin.bottom,outerRadius=w/2*.88,innerRadius=w/2*.64,labelRadius=w/2*.98,tipDuration=200,donutDuration=600;d3.csv("/8step.io/production_data/ctc_data/divisions.csv",function(error,data){function arcTween(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return arcDef(a(t))}}error?console.log(error):console.log(data);var donutData=data,arcData=function(t){return+t.revenue_total},svg=d3.select("#donut-div").append("svg").attr("width",w+donutMargin.left+donutMargin.right).attr("height",h+donutMargin.top+donutMargin.bottom).attr("id","donut-canvas").append("g").attr("transform","translate("+(w/2+donutMargin.left)+","+(h/2+donutMargin.top)+")"),color=d3.scaleOrdinal().range(["#FBAF43","#198F90","#9E004D","#F1594E","#9BD19D"]),arcDef=d3.arc().outerRadius(outerRadius).innerRadius(innerRadius),arcDefLabel=d3.arc().outerRadius(labelRadius).innerRadius(outerRadius),pie=d3.pie().sort(null).value(function(t){return arcData(t)}),arc=svg.selectAll("g.arc").data(pie(donutData)).enter().append("g").attr("class","arc"),arcPath=arc.append("path").attr("d",arcDef).attr("class","arc-path").style("fill",function(t){return color(t.data.division_clean)}).each(function(t){this._current=t}),donutLabels=arc.append("text").attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("fill","white").attr("class","arc-label").attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean}),donutTip=d3.select("#donut-div").append("div").attr("class","tooltip donut-tip").style("position","absolute").style("left",(w+donutMargin.left+donutMargin.right)/2).style("top",h/2+donutMargin.top).style("opacity",0);arcPath.on("mouseover",function(t){donutTip.transition().duration(tipDuration).style("opacity",1),donutTip.html("<div class='title-display'>"+t.data.division_display+", FY17</div><br /><div class = data-display>Total Projects:<strong> "+t.data.projects_total+"</strong><br />Total Revenue: <strong>$"+d3.format(",.2f")(t.data.revenue_total)+"</strong><br />Avg Revenue/Project:<strong> $"+d3.format(",.2f")(t.data.avg_revenue)+"</strong></div>")}).on("mouseout",function(t){donutTip.transition().duration(tipDuration).style("opacity",0)}),d3.selectAll(".m-choice").on("click",function(){var lineValue=d3.select(this).attr("value"),arcValue=lineValue,lineData=function(d){return eval(lineValue)};switch(lineValue){case"d.projects_total":dataTitle="Total Projects";break;case"d.revenue_total":dataTitle="Total Revenue ($US)";break;case"d.avg_revenue":dataTitle="Avg. Revenue / Project ($US)"}titleText.text(dataTitle+" by Division, CTC, FY17"),d3.csv("/8step.io/production_data/ctc_data/ctc_lines.csv",function(t){return t.date=parseDate(t.date),t.division_clean=t.division_clean,t.avg_revenue=+t.avg_revenue,t.projects_share=+t.projects_share,t.projects_total=+t.projects_total,t.revenue_share=+t.revenue_share,t.revenue_total=+t.revenue_total,t},function(t,a){t&&console.log(t);var e=d3.scaleLinear().range([lineH,0]);e.domain(d3.extent(timeData,function(t){return lineData(t)})).nice();var n=d3.line().x(function(t){return xScale(t.date)}).y(function(t){return e(lineData(t))});d3.selectAll(".nodes").on("mouseover",function(t){lineTip.transition().duration(tipDuration).style("display","inline-block"),lineTip.html("<p><span class='line-val-display'>"+d3.format(",.2f")(lineData(t))+"</span><br /><span class='time-display'>"+formatTimeMonth(t.date)+" "+formatTimeYear(t.date)+"</span></p>").style("left",d3.select(this).attr("cx")).style("top",d3.select(this).attr("cy"))}).on("mouseout",function(){lineTip.transition().duration(tipDuration).style("display","none")}),pathUSH.transition().duration(lineDuration).attr("d",n),nodesUSH.transition().duration(lineDuration).attr("cy",function(t){return e(lineData(t))}),pathSEP.transition().duration(lineDuration).attr("d",n),nodesSEP.transition().duration(lineDuration).attr("cy",function(t){return e(lineData(t))}),pathIHD.transition().duration(lineDuration).attr("d",n),nodesIHD.transition().duration(lineDuration).attr("cy",function(t){return e(lineData(t))}),pathIEG.transition().duration(lineDuration).attr("d",n),nodesIEG.transition().duration(lineDuration).attr("cy",function(t){return e(lineData(t))}),pathENR.transition().duration(lineDuration).attr("d",n),nodesENR.transition().duration(lineDuration).attr("cy",function(t){return e(lineData(t))});var r=d3.axisLeft().scale(e);d3.select(".y-axis").transition().duration(lineDuration).call(r);d3.select(".y-axis text").node().getBBox();yLabel.text(dataTitle).transition().duration(lineDuration).attr("transform","translate("+yLabelShift+","+lineH/2+"), rotate(-90)")});var arcData=function(d){return eval(arcValue)};pie.value(function(t){return arcData(t)}),arcPath.data(pie(donutData)),arcPath.transition().duration(donutDuration).attrTween("d",arcTween),d3.selectAll(".arc-label").data(pie(donutData)).transition().duration(donutDuration).attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean})})})}),d3.selectAll(".m-choice").on("click",function(){var lineValue=d3.select(this).attr("value"),lineData=function(d){return eval(lineValue)};yScale.domain(d3.extent(timeData,function(t){return lineData(t)})).nice();var line=d3.line().x(function(t){return xScale(t.date)}).y(function(t){return yScale(lineData(t))});pathUSH.transition().duration(lineDuration).attr("d",line),nodesUSH.transition().duration(lineDuration).attr("cy",function(t){return yScale(lineData(t))}),pathSEP.transition().duration(lineDuration).attr("d",line),nodesSEP.transition().duration(lineDuration).attr("cy",function(t){return yScale(lineData(t))}),pathIHD.transition().duration(lineDuration).attr("d",line),nodesIHD.transition().duration(lineDuration).attr("cy",function(t){return yScale(lineData(t))}),pathIEG.transition().duration(lineDuration).attr("d",line),nodesIEG.transition().duration(lineDuration).attr("cy",function(t){return yScale(lineData(t))}),pathENR.transition().duration(lineDuration).attr("d",line),nodesENR.transition().duration(lineDuration).attr("cy",function(t){return yScale(lineData(t))});var arcValue=d3.select(this).attr("value"),arcData=function(d){return eval(arcValue)};pie.value(function(t){return arcData(t)}),arcPath.data(pie(donutData)),arcPath.transition().duration(donutDuration).attrTween("d",arcTween),d3.selectAll(".arc-label").data(pie(donutData)).transition().duration(donutDuration).attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean})});var donutMargin={top:10,right:60,bottom:20,left:60},w=parseInt(d3.select("#donut-div").style("width"),10),w=w-donutMargin.left-donutMargin.right,h=parseInt(d3.select("#donut-div").style("height"),10),h=h-donutMargin.top-donutMargin.bottom,radius=Math.min(w,h)/2,labelRadius=w/2+8,tipDuration=200,donutDuration=600;d3.csv("/8step.io/production_data/ctc_data/divisions.csv",function(error,data){function arcTween(t){var a=d3.interpolate(this._current,t);return this._current=a(0),function(t){return arcDef(a(t))}}error?console.log(error):console.log(data);var donutData=data,arcData=function(t){return+t.avg_revenue},svg=d3.select("#donut-div").append("svg").attr("width",w+donutMargin.left+donutMargin.right).attr("height",h+donutMargin.top+donutMargin.bottom).attr("id","canvas").append("g").attr("transform","translate("+(w/2+donutMargin.left)+","+(h/2+donutMargin.top)+")"),donutTip=d3.select("body").append("div").attr("class","tooltip donut-tip").style("opacity",0),color=d3.scaleOrdinal().range(["#FBAF43","#198F90","#9E004D","#F1594E","#9BD19D"]),arcDef=d3.arc().outerRadius(radius-10).innerRadius(radius-80),arcDefLabel=d3.arc().outerRadius(radius+40).innerRadius(radius),pie=d3.pie().sort(null).value(function(t){return arcData(t)}),arc=svg.selectAll(".arc").data(pie(donutData)).enter().append("g").attr("class","arc"),arcPath=arc.append("path").attr("d",arcDef).attr("class","arc-path").style("fill",function(t){return color(t.data.division_clean)}).each(function(t){this._current=t}),donutLabels=arc.append("text").attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("fill","white").attr("class","arc-label").attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean});arcPath.on("mouseover",function(t){donutTip.transition().duration(tipDuration).style("opacity",1),donutTip.html("<div class='title-display'>"+t.data.division_display+", FY17</div><br /><div class = data-display>Total Projects: "+t.data.projects+"<br />Total Revenue: $"+d3.format(",")(+t.data.revenue)+"</div>").style("left","18em").style("top","2em")}).on("mouseout",function(t){donutTip.transition().duration(tipDuration).style("opacity",0)}),d3.selectAll(".m-choice").on("click",function(){var arcValue=d3.select(this).attr("value"),arcData=function(d){return eval(arcValue)};pie.value(function(t){return arcData(t)}),arcPath.data(pie(donutData)),arcPath.transition().duration(donutDuration).attrTween("d",arcTween),d3.selectAll(".arc-label").data(pie(donutData)).transition().duration(donutDuration).attr("transform",function(t){return"translate("+arcDefLabel.centroid(t)+")"}).attr("text-anchor",function(t){return(t.endAngle+t.startAngle)/2>Math.PI?"end":"start"}).text(function(t){return t.data.division_clean})})});var margin={top:10,right:20,bottom:20,left:80},w=parseInt(d3.select("#line-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#line-div").style("height"),10),h=h-margin.top-margin.bottom,parseDate=d3.timeParse("%Y"),formatTime=d3.timeFormat("%Y"),xScale=d3.scaleTime().range([0,w]),yScale=d3.scaleLinear().range([h,0]),yLabelShift=margin.left/2-10,tipDuration=100;d3.csv("/8step.io/production_data/energy_data/solar.csv",function(t){return t.year=parseDate(t.year),t.solar_price=+t.solar_price,t},function(t,a){t?console.log(t):console.log(a);var e=a;xScale.domain(d3.extent(e,function(t){return t.year})),yScale.domain(d3.extent(e,function(t){return t.solar_price})).nice();var n=d3.axisBottom().scale(xScale),r=d3.axisLeft().scale(yScale),i=d3.line().x(function(t){return xScale(t.year)}).y(function(t){return yScale(t.solar_price)}),o=d3.select("#line-div").append("svg").attr("width",w+margin.left+margin.right).attr("height",h+margin.top+margin.bottom).attr("id","canvas").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),l=d3.select("body").append("div").attr("class","tooltip price-tip").style("opacity",0),d=(o.append("path").datum(e).attr("d",i).attr("class","line"),o.selectAll("circle").data(e).enter().append("circle").attr("class","nodes price-nodes").attr("r","0.15em").attr("cx",function(t){return xScale(t.year)}).attr("cy",function(t){return yScale(t.solar_price)}));d.on("mouseover",function(t){l.transition().duration(tipDuration).style("opacity",.8),l.html("<span class='value-display'>$"+d3.format(".3n")(t.solar_price)+"</span><br /><span class = date-display>"+formatTime(t.year)+"</span>").style("left",d3.select(this).attr("cx")+"px").style("top",d3.select(this).attr("cy")+"px")}).on("mouseout",function(t){l.transition().duration(tipDuration).style("opacity",0)}),o.append("g").attr("class","axis x-axis").attr("transform","translate(0,"+h+")").call(n),o.append("g").attr("class","axis y-axis").call(r).append("text").text("Price, US$/Watt").attr("fill","gray").attr("transform","translate("+yLabelShift+","+(h/2-margin.bottom-margin.top)+"), rotate(-90)")});var margin={top:10,right:10,bottom:10,left:80},w=parseInt(d3.select("#map-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#map-div").style("height"),10),h=h-margin.top-margin.bottom,parseDate=d3.timeParse("%Y"),formatTime=d3.timeFormat("%Y"),svg=d3.select("#map-div").append("svg").attr("width",w+margin.left+margin.right).attr("height",h+margin.left+margin.right).attr("id","map-canvas").append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.queue().defer(d3.json,"https://d3js.org/us-10m.v1.json").defer(d3.csv,"/8step.io/production_data/employment_data/county_8.16.csv").await(ready);var mapPath=d3.geoPath(),margin={top:80,right:140,bottom:40,left:60},w=parseInt(d3.select("#scatter-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#scatter-div").style("height"),10),h=h-margin.top-margin.bottom,canvasPadding={top:10,right:10,bottom:10,left:60},textShift=0,dotsShiftX=0,dotsShiftY=0,xaxisShiftX=60,yaxisShiftX=60,xaxisShiftY=-60,yaxisShiftY=0,infoTop=115,infoLeft=w+margin.left,infoWidth="12em",infoHeight="24em";d3.csv("/8step.io/production_data/world_data/datadev/world.csv",function(error,data){error?console.log(error):console.log(data);var worldData=data,key=function(t,a){return t.country},dataX=function(t){return+t.polistab},dataY=function(t){return 100-+t.press},dataR=function(t){return+t.gdphead};console.log(dataX.toString());var titleX="Political Stabtility",titleY="Press Freedom",titleR="GDP per Capita",titleText=d3.select("h2#chart-title").append("text").attr("class","title-text").text(titleX+" vs. "+titleY),dotTips=d3.tip().attr("class","d3-tip").style({top:infoTop,left:infoLeft,width:infoWidth,height:infoHeight}).direction("e").html(function(t){return"<p id='tiphead'>"+t.country+"</p><p class='tip-subhead'>Income Group:</p><p class='tip-body'>"+t.ig+"</p><p class='tip-subhead'>Region:</p><p class='tip-body'>"+t.region+"</p>"}),svg=d3.select("#scatter-div").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}),xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([xaxisShiftX,w]).nice(),yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h+xaxisShiftY]).nice(),rScale=d3.scale.linear().domain([0,d3.max(worldData,function(t){return dataR(t)})]).range([4,40]).nice(),xAxis=d3.svg.axis().scale(xScale).orient("bottom"),yAxis=d3.svg.axis().scale(yScale).orient("left"),guideLines=function(t){svg.append("g").classed("guide",!0).append("line").attr("y1",d3.select(".a-dot").attr("cy")).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",yaxisShiftX).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill")),svg.append("g").classed("guide",!0).append("line").attr("y1",h+xaxisShiftY).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",d3.select(".a-dot").attr("cx")).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill"))},mouseOn=function(){d3.select(this).attr("opacity",1).classed("a-dot",!0).classed("dots",!1),guideLines(),d3.selectAll("circle.dots").attr("opacity",.15)},mouseOff=function(){d3.select(this).classed("a-dot",!1).classed("dots",!0),d3.selectAll(".guide").remove(),d3.selectAll("circle.dots").attr("opacity",.85)},dotsGroup=svg.append("g").attr({id:"dots-group"}),dotsFilter=dotsGroup.append("defs").append("filter").attr({id:"dots-filter",x:0,y:0,width:"200%",height:"200%"}),shadowOffset=dotsFilter.append("feOffset").attr({result:"offOut",in:"SourceGraphic",dx:20,dy:20}),shadowBlend=dotsFilter.append("feBlend").attr({in:"SourceGraphic",in2:"offOut",mode:"normal"}),dots=d3.select("#dots-group").selectAll("circle").data(worldData,key).enter().append("circle").filter(function(t){return dataX(t)}).filter(function(t){return dataY(t)}).filter(function(t){return dataR(t)}).attr({class:"dots",id:function(t){return t.country},cx:function(t){return xScale(dataX(t))},cy:function(t){return yScale(dataY(t))},r:function(t){return rScale(dataR(t))},"pointer-events":"all",fill:function(t){return"High income: nonOECD"==t.ig?"#FF6E27":"Low income"==t.ig?"#991766":"Upper middle income"==t.ig?"#F34739":"Lower middle income"==t.ig?"#D90F5A":"High income: OECD"==t.ig?"#FFB627":"black"},opacity:.85}).style({}).call(dotTips).on("mouseenter",dotTips.show).on("mouseover",mouseOn).on("mouseleave",dotTips.hide).on("mouseout",mouseOff);svg.append("g").attr({class:"xaxis",transform:"translate(0,"+(h+xaxisShiftY)+")"}).call(xAxis);var xLabel=svg.append("text").attr({class:"x-label","text-anchor":"middle",transform:function(t){return"translate("+w/2+","+h+")"}}).text(titleX);svg.append("g").attr({class:"yaxis",transform:"translate("+yaxisShiftX+",0)"}).call(yAxis);var yLabel=svg.append("text").attr({class:"y-label","text-anchor":"middle",transform:function(t){return"translate(0,"+(h+xaxisShiftY)/2+") rotate(-90)"}}).text(titleY);d3.selectAll(".x-choice").on("click",function(){var xValue=d3.select(this).attr("value");console.log(xValue);var dataX=function(d){return eval(xValue)};switch(xValue){case"+d.gini":titleX="Gini Index";break;case"+d.press":titleX="Press Freedom";break;case"+d.mfr":titleX="Male to female Ratio";break;case"+d.life_exp":titleX="Life Expectancy";break;case"+d.gre":titleX="Female enrollment ratio";break;case"+d.corruption":titleX="Control of Corruption";break;case"+d.polistab":titleX="Political Stability";break;case"+d.gdphead":titleX="GDP per Capita"}var xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([xaxisShiftX,w]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){return dataX(t)}).transition().duration(1e3).attr({cx:function(t){return xScale(dataX(t))}});var xAxis=d3.svg.axis().scale(xScale).orient("bottom");xLabel.text(titleX),titleText.text(titleX+" vs. "+titleY),d3.select(".xaxis").transition().duration(1e3).call(xAxis)}),d3.selectAll(".y-choice").on("click",function(){var yValue=d3.select(this).attr("value");console.log(yValue);var dataY=function(d){return eval(yValue)};switch(yValue){case"+d.gini":titleY="Gini Index";break;case"+d.press":titleY="Press Freedom";break;case"+d.mfr":titleY="Male to female Ratio";break;case"+d.life_exp":titleY="Life Expectancy";break;case"+d.gre":titleY="Female enrollment ratio";break;case"+d.corruption":titleY="Control of Corruption";break;case"+d.polistab":titleY="Political Stability";break;case"+d.gdphead":titleY="GDP per Capita"}var yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h+xaxisShiftY]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){return dataY(t)}).transition().duration(1e3).attr({cy:function(t){return yScale(dataY(t))}});var yAxis=d3.svg.axis().scale(yScale).orient("left");yLabel.text(titleY),titleText.text(titleX+" vs. "+titleY),d3.select(".yaxis").transition().duration(1e3).call(yAxis)})});var margin={top:80,right:140,bottom:40,left:60},w=parseInt(d3.select("#scatter-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#scatter-div").style("height"),10),h=h-margin.top-margin.bottom,canvasPadding={top:10,right:10,bottom:10,left:60},textShift=0,dotsShiftX=0,dotsShiftY=0,xaxisShiftX=60,yaxisShiftX=60,xaxisShiftY=-60,yaxisShiftY=0,infoTop=115,infoLeft=w+margin.left,infoWidth="12em",infoHeight="24em";d3.csv("/8step.io/production_data/world_data/datadev/world.csv",function(error,data){error?console.log(error):console.log(data);var worldData=data,key=function(t,a){return t.country},dataX=function(t){return+t.polistab},dataY=function(t){return 100-+t.press},dataR=function(t){return+t.gdphead};console.log(dataX.toString());var titleX="Political Stabtility",titleY="Press Freedom",titleR="GDP per Capita",titleText=d3.select("h2#chart-title").append("text.title-text").text(titleX+" vs. "+titleY),dotTips=d3.tip().attr("class","d3-tip").style({top:infoTop,left:infoLeft,width:infoWidth,height:infoHeight}).direction("e").html(function(t){return"<p id='tiphead'>"+t.country+"</p><p class='tip-subhead'>Income Group:</p><p class='tip-body'>"+t.ig+"</p><p class='tip-subhead'>Region:</p><p class='tip-body'>"+t.region+"</p>"}),svg=d3.select("#scatter-div").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}),xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([xaxisShiftX,w]).nice(),yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h+xaxisShiftY]).nice(),rScale=d3.scale.linear().domain([0,d3.max(worldData,function(t){return dataR(t)})]).range([4,40]).nice(),xAxis=d3.svg.axis().scale(xScale).orient("bottom"),yAxis=d3.svg.axis().scale(yScale).orient("left"),guideLines=function(t){svg.append("g").classed("guide",!0).append("line").attr("y1",d3.select(".a-dot").attr("cy")).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",yaxisShiftX).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill")),svg.append("g").classed("guide",!0).append("line").attr("y1",h+xaxisShiftY).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",d3.select(".a-dot").attr("cx")).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill"))},mouseOn=function(){d3.select(this).attr("opacity",1).classed("a-dot",!0).classed("dots",!1),guideLines(),d3.selectAll("circle.dots").attr("opacity",.15)},mouseOff=function(){d3.select(this).classed("a-dot",!1).classed("dots",!0),d3.selectAll(".guide").remove(),d3.selectAll("circle.dots").attr("opacity",.85)},dotsGroup=svg.append("g").attr({id:"dots-group"}),dotsFilter=dotsGroup.append("defs").append("filter").attr({id:"dots-filter",x:0,y:0,width:"200%",height:"200%"}),shadowOffset=dotsFilter.append("feOffset").attr({result:"offOut",in:"SourceGraphic",dx:20,dy:20}),shadowBlend=dotsFilter.append("feBlend").attr({in:"SourceGraphic",in2:"offOut",mode:"normal"}),dots=d3.select("#dots-group").selectAll("circle").data(worldData,key).enter().append("circle").filter(function(t){return dataX(t)}).filter(function(t){return dataY(t)}).filter(function(t){return dataR(t)}).attr({class:"dots",id:function(t){return t.country},cx:function(t){return xScale(dataX(t))},cy:function(t){return yScale(dataY(t))},r:function(t){return rScale(dataR(t))},"pointer-events":"all",fill:function(t){return"High income: nonOECD"==t.ig?"#FF6E27":"Low income"==t.ig?"#991766":"Upper middle income"==t.ig?"#F34739":"Lower middle income"==t.ig?"#D90F5A":"High income: OECD"==t.ig?"#FFB627":"black"},opacity:.85}).style({}).call(dotTips).on("mouseenter",dotTips.show).on("mouseover",mouseOn).on("mouseleave",dotTips.hide).on("mouseout",mouseOff);svg.append("g").attr({class:"xaxis",transform:"translate(0,"+(h+xaxisShiftY)+")"}).call(xAxis);var xLabel=svg.append("text").attr({class:"x-label","text-anchor":"middle",transform:function(t){return"translate("+w/2+","+h+")"}}).text(titleX);svg.append("g").attr({class:"yaxis",transform:"translate("+yaxisShiftX+",0)"}).call(yAxis);var yLabel=svg.append("text").attr({class:"y-label","text-anchor":"middle",transform:function(t){return"translate(0,"+(h+xaxisShiftY)/2+") rotate(-90)"}}).text(titleY);d3.selectAll(".x-choice").on("click",function(){var xValue=d3.select(this).attr("value");console.log(xValue);var dataX=function(d){return eval(xValue)};switch(xValue){case"+d.gini":titleX="Gini Index";break;case"+d.press":titleX="Press Freedom";break;case"+d.mfr":titleX="Male to female Ratio";break;case"+d.life_exp":titleX="Life Expectancy";break;case"+d.gre":titleX="Female enrollment ratio";break;case"+d.corruption":titleX="Control of Corruption";break;case"+d.polistab":titleX="Political Stability";break;case"+d.gdphead":titleX="GDP per Capita"}var xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([xaxisShiftX,w]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){return dataX(t)}).transition().duration(1e3).attr({cx:function(t){return xScale(dataX(t))}});var xAxis=d3.svg.axis().scale(xScale).orient("bottom");xLabel.text(titleX),titleText.text(titleX+" vs. "+titleY),d3.select(".xaxis").transition().duration(1e3).call(xAxis)}),d3.selectAll(".y-choice").on("click",function(){var yValue=d3.select(this).attr("value");console.log(yValue);var dataY=function(d){return eval(yValue)};switch(yValue){case"+d.gini":titleY="Gini Index";break;case"+d.press":titleY="Press Freedom";break;case"+d.mfr":titleY="Male to female Ratio";break;case"+d.life_exp":titleY="Life Expectancy";break;case"+d.gre":titleY="Female enrollment ratio";break;case"+d.corruption":titleY="Control of Corruption";break;case"+d.polistab":titleY="Political Stability";break;case"+d.gdphead":titleY="GDP per Capita"}var yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h+xaxisShiftY]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){
return dataY(t)}).transition().duration(1e3).attr({cy:function(t){return yScale(dataY(t))}});var yAxis=d3.svg.axis().scale(yScale).orient("left");yLabel.text(titleY),titleText.text(titleX+" vs. "+titleY),d3.select(".yaxis").transition().duration(1e3).call(yAxis)})});var margin={top:40,right:10,bottom:40,left:10},w=parseInt(d3.select("#barsdiv").style("width"),10),w=w-margin.left-margin.right,h=8e3-margin.top-margin.bottom,canvasPadding={top:0,right:100,bottom:0,left:0},textShiftUp=-134,barShiftUp=-126,axisShiftUp=-18;barpadding=2,labelPaddingLeft=4,labelPaddingTop=barShiftUp+138;var maxDelay=1e4,barDuration=800,axisDuration=800,defaultFade=50,hoverDuration=200,titleText=d3.select("h2#title").append("text.title-text").text("Incidents of Murder, per 100k Individuals, 2013").attr({class:"title-text","font-size":"24px"});d3.csv("/8step.io/production_data/crime_data/datadev/crime.csv",function(t,a){t?console.log(t):console.log(a);var e=a,n=function(t,a){return a},r=function(t){return"M.D."==t.Loc.slice(-4)?t.Loc.substring(0,t.Loc.length-5):"M.S.A."==t.Loc.slice(-6)?t.Loc.substring(0,t.Loc.length-7):t.Loc.substring(0,t.Loc.length-7)},i=d3.tip().attr({class:"d3-tip"}).offset([0,0]).direction("n").html(function(t){return"<p id='tiphead'>"+r(t)+"</p><p id='tipbody'>Population: "+d3.format(",")(+t.Pop)+"</p>"}),o=d3.select("#barsdiv").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,viewBox:"0 0 380 8000",preserveAspectRatio:"xMinYMin meet",id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}).call(i),l=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice(),d=function(t){return l(+t.murder100k)},s=function(t){return d(t)+labelPaddingLeft},c=d3.scale.ordinal().domain(d3.range(e.length)).rangeRoundBands([0,h],.05),u=d3.svg.axis().scale(l).orient("top").ticks(5);o.selectAll("rect").data(e,n).enter().append("rect").attr({y:function(t,a){return c(a)},x:function(t){return 0},width:d,height:function(t,a){return c.rangeBand()},transform:"translate(0,"+barShiftUp+")",class:"bars"}).on("mouseover",i.show).on("mouseout",i.hide),o.selectAll("text.loclabels").data(e,n).enter().append("text").text(r).attr({x:function(t){return labelPaddingLeft},y:function(t,a){return c(a)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"loclabels"}),o.selectAll("text.valuelabels").data(e,n).enter().append("text").text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"valuelabels"});o.append("g").attr({class:"xaxis",transform:"translate(0,"+axisShiftUp+")"}).call(u),d3.select("button#violentcrime").on("click",function(){g()}),d3.select("button#rape").on("click",function(){f()}),d3.select("button#murder").on("click",function(){p()});var p=function(){e.sort(function(t,a){return d3.descending(+t.murder100k,+a.murder100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice();d=function(a){return t(+a.murder100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Murder, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),o.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},f=function(){e.sort(function(t,a){return d3.descending(+t.rape100k,+a.rape100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.rape100k})]).range([0,w-canvasPadding.right]).nice();d=function(a){return t(+a.rape100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Rape, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.rape100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),o.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},g=function(){e.sort(function(t,a){return d3.descending(+t.violentcrime100k,+a.violentcrime100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.violentcrime100k})]).range([0,w-canvasPadding.right]).nice();d=function(a){return t(+a.violentcrime100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:d,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Violent Crime, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.violentcrime100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),o.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},m=function(){var t=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;8e3-margin.top-margin.bototm;l.range([0,t-canvasPadding.right]),d3.select("svg").attr("width",t),o.selectAll("rect.bars").attr("width",d),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(u)};d3.select(window).on("resize",function(){m()})});