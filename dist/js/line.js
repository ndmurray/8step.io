"use strict";var margin={top:10,right:20,bottom:20,left:80},w=(w=parseInt(d3.select("#line-div").style("width"),10))-margin.left-margin.right,h=(h=parseInt(d3.select("#line-div").style("height"),10))-margin.top-margin.bottom,parseDate=d3.timeParse("%Y"),formatTime=d3.timeFormat("%Y"),xScale=d3.scaleTime().range([0,w]),yScale=d3.scaleLinear().range([h,0]),yLabelShift=margin.left/2-10,tipDuration=100;d3.csv("/nickm.io/production_data/energy_data/solar.csv",function(t){return t.year=parseDate(t.year),t.solar_price=+t.solar_price,t},function(t,a){t?console.log(t):console.log(a);var e=a;xScale.domain(d3.extent(e,function(t){return t.year})),yScale.domain(d3.extent(e,function(t){return t.solar_price})).nice();var r=d3.axisBottom().scale(xScale),i=d3.axisLeft().scale(yScale),n=d3.line().x(function(t){return xScale(t.year)}).y(function(t){return yScale(t.solar_price)}),s=d3.select("#line-div").append("svg").attr("width",w+margin.left+margin.right).attr("height",h+margin.top+margin.bottom).attr("id","canvas").append("g").attr("transform","translate("+margin.left+","+margin.top+")"),l=d3.select("body").append("div").attr("class","tooltip price-tip").style("opacity",0);s.append("path").datum(e).attr("d",n).attr("class","line");s.selectAll("circle").data(e).enter().append("circle").attr("class","nodes price-nodes").attr("r","0.15em").attr("cx",function(t){return xScale(t.year)}).attr("cy",function(t){return yScale(t.solar_price)}).on("mouseover",function(t){l.transition().duration(tipDuration).style("opacity",.8),l.html("<span class='value-display'>$"+d3.format(".3n")(t.solar_price)+"</span><br /><span class = date-display>"+formatTime(t.year)+"</span>").style("left",d3.select(this).attr("cx")+"px").style("top",d3.select(this).attr("cy")+"px")}).on("mouseout",function(t){l.transition().duration(tipDuration).style("opacity",0)}),s.append("g").attr("class","axis x-axis").attr("transform","translate(0,"+h+")").call(r),s.append("g").attr("class","axis y-axis").call(i).append("text").text("Price, US$/Watt").attr("fill","gray").attr("transform","translate("+yLabelShift+","+(h/2-margin.bottom-margin.top)+"), rotate(-90)")});