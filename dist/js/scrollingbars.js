"use strict";var margin={top:40,right:10,bottom:40,left:10},w=(w=parseInt(d3.select("#barsdiv").style("width"),10))-margin.left-margin.right,h=8e3-margin.top-margin.bottom,canvasPadding={top:0,right:100,bottom:0,left:0},textShiftUp=-134,barShiftUp=-126,axisShiftUp=-18;barpadding=2,labelPaddingLeft=4,labelPaddingTop=barShiftUp+138;var maxDelay=1e4,barDuration=800,axisDuration=800,defaultFade=50,hoverDuration=200,titleText=d3.select("h2#title").append("text.title-text").text("Incidents of Murder, per 100k Individuals, 2013").attr({class:"title-text","font-size":"24px"});d3.csv("/nickm.io/production_data/crime_data/datadev/crime.csv",function(t,a){t?console.log(t):console.log(a);var e=a,n=function(t,a){return a},r=function(t){return"M.D."==t.Loc.slice(-4)?t.Loc.substring(0,t.Loc.length-5):(t.Loc.slice(-6),t.Loc.substring(0,t.Loc.length-7))},i=d3.tip().attr({class:"d3-tip"}).offset([0,0]).direction("n").html(function(t){return"<p id='tiphead'>"+r(t)+"</p><p id='tipbody'>Population: "+d3.format(",")(+t.Pop)+"</p>"}),l=d3.select("#barsdiv").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,viewBox:"0 0 380 8000",preserveAspectRatio:"xMinYMin meet",id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}).call(i),d=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice(),o=function(t){return d(+t.murder100k)},s=function(t){return o(t)+labelPaddingLeft},c=d3.scale.ordinal().domain(d3.range(e.length)).rangeRoundBands([0,h],.05),u=d3.svg.axis().scale(d).orient("top").ticks(5);l.selectAll("rect").data(e,n).enter().append("rect").attr({y:function(t,a){return c(a)},x:function(t){return 0},width:o,height:function(t,a){return c.rangeBand()},transform:"translate(0,"+barShiftUp+")",class:"bars"}).on("mouseover",i.show).on("mouseout",i.hide),l.selectAll("text.loclabels").data(e,n).enter().append("text").text(r).attr({x:function(t){return labelPaddingLeft},y:function(t,a){return c(a)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"loclabels"}),l.selectAll("text.valuelabels").data(e,n).enter().append("text").text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop},transform:"translate(0,"+textShiftUp+")",class:"valuelabels"});l.append("g").attr({class:"xaxis",transform:"translate(0,"+axisShiftUp+")"}).call(u),d3.select("button#violentcrime").on("click",function(){m()}),d3.select("button#rape").on("click",function(){f()}),d3.select("button#murder").on("click",function(){g()});var g=function(){e.sort(function(t,a){return d3.descending(+t.murder100k,+a.murder100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.murder100k})]).range([0,w-canvasPadding.right]).nice();o=function(a){return t(+a.murder100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:o,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Murder, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.murder100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;margin.top,margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",o),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},f=function(){e.sort(function(t,a){return d3.descending(+t.rape100k,+a.rape100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.rape100k})]).range([0,w-canvasPadding.right]).nice();o=function(a){return t(+a.rape100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:o,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Rape, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.rape100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;margin.top,margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",o),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},m=function(){e.sort(function(t,a){return d3.descending(+t.violentcrime100k,+a.violentcrime100k)});var t=d3.scale.linear().domain([0,d3.max(e,function(t){return+t.violentcrime100k})]).range([0,w-canvasPadding.right]).nice();o=function(a){return t(+a.violentcrime100k)},d3.selectAll("rect.bars").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).ease("cubic-in-out").attr({width:o,y:function(t,a){return c(a)}}),d3.select("h2#title").transition().duration(barDuration).text("Incidents of Violent Crime, per 100k Individuals, 2013"),d3.selectAll("text.loclabels").data(e,n).transition().duration(barDuration).ease("cubic-in-out").text(r).attr({y:function(t,a){return c(a)+labelPaddingTop}}),d3.selectAll("text.valuelabels").data(e,n).transition().delay(function(t,a){return a/e.length*maxDelay}).duration(barDuration).text(function(t){return d3.format(",")(+t.violentcrime100k)}).attr({x:s,y:function(t,a){return c(a)+labelPaddingTop}});var a=d3.svg.axis().scale(t).orient("top").ticks(5);d3.select(".xaxis").transition().duration(axisDuration).call(a);var i=function(){var r=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;margin.top,margin.bototm;t.range([0,r-canvasPadding.right]),d3.select("svg").attr("width",r),l.selectAll("rect.bars").attr("width",o),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(a)};d3.select(window).on("resize",function(){i()})},x=function(){var t=parseInt(d3.select("#barsdiv").style("width"))-margin.left-margin.right;margin.top,margin.bototm;d.range([0,t-canvasPadding.right]),d3.select("svg").attr("width",t),l.selectAll("rect.bars").attr("width",o),d3.selectAll("text.valuelabels").data(e,n).attr("x",s),d3.select(".xaxis").call(u)};d3.select(window).on("resize",function(){x()})});